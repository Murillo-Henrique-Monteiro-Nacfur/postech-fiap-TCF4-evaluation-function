swagger: "2.0"
info:
  title: API Gateway para Avaliações
  description: "Recebe uma avaliação e a encaminha para o backend."
  version: 1.0.0

schemes:
  - https

produces:
  - application/json

consumes:
  - application/json

basePath: /

securityDefinitions:
  api_key:
    type: "apiKey"
    name: "key"
    in: "query"

paths:
  /v1/evaluations:
    post:
      summary: Envia uma nova avaliação.
      description: "Recebe um objeto de avaliação e o encaminha diretamente para o backend."
      operationId: processEvaluation
      security:
        - api_key: []
      parameters:
        - in: body
          name: body
          description: O objeto de avaliação a ser processado.
          required: true
          schema:
            $ref: "#/definitions/EvaluationPayload"

      responses:
        "202":
          description: "Requisição aceita e encaminhada ao backend."
        "403":
          description: "API Key inválida ou ausente."
        "406":
          description: "Erro de negócio: A nota deve estar entre 0 e 10."
          schema:
            $ref: "#/definitions/ErrorResponse"
        "500":
          description: "Erro interno no processamento do backend."
          schema:
            $ref: "#/definitions/ErrorResponse"

      x-google-backend:
        address: https://evaluation-function-241672042524.southamerica-east1.run.app/processNewEvaluation
        path_translation: CONSTANT_ADDRESS

# Definições dos schemas
definitions:
  EvaluationPayload:
    type: object
    description: "Formato simples para enviar uma avaliação."
    required:
      - nota
    properties:
      nota:
        type: integer
        format: int32
        description: "A nota da avaliação (ex: 1 a 10)."
        example: 10
      descricao:
        type: string
        description: "Um comentário opcional sobre a avaliação."
        example: "Serviço excelente!"

  # NOVO: Definição para capturar o erro do seu ExceptionHandlerInterceptor
  ErrorResponse:
    type: object
    properties:
      message:
        type: string
        description: "Mensagem detalhada do erro."
        example: "A nota deve estar entre 0 e 10."
      code:
        type: string
        description: "Código interno do erro."
        example: "INVALID_RATING"
      timestamp:
        type: string
        description: "Data e hora do erro."
        example: "2026-01-08T20:43:53.406259"